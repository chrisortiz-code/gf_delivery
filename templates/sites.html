{% extends "base.html" %}

{% block title %}Sites and Employees{% endblock %}

{% block header_title %}Sites Overview{% endblock %}

{% block extra_head %}
<style>
    table { border-collapse: collapse; width: 100%; margin-bottom: 2rem; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f0f0f0; }
    .site-section { margin-bottom: 2rem; border: 2px solid #be4272; border-radius: 8px; padding: 1rem; }
    .site-title { font-size: 1.2rem; font-weight: bold; color: #be4272; margin-bottom: 0.5rem; }
</style>
{% endblock %}

{% block content %}
<div style="text-align: center;">
    <h2>Sites Overview</h2>
    {% for site in sites %}
    <div class="site-section">
        <div class="site-title">Site ID: {{ site.id }} | Location: {{ site.location }} | Total Owing: {{ site.total_owing }}</div>
        <table>
            <thead>
                <tr>
                    <th>Employee</th>
                    <th>Current Owing</th>
                    <th>Items</th>
                    <th>Signature</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in site.employees %}
                <tr>
                    <td>{{ emp.name }}</td>
                    <td>{{ emp.current_owing }}</td>
                    <td style="max-width: 400px; word-break: break-all;">
                      <ul style="list-style: none; padding-left: 0; margin: 0;">
                        {% for item in emp.parsed_items %}
                          <li>{{ item.name }} @ ${{ item.price }} Ã— {{ item.qty }}</li>
                        {% endfor %}
                      </ul>
                    </td>
                    <td>
                      {% if emp.signature %}
                        <img src="{{ emp.signature }}" alt="Signature" style="max-width: 100px; max-height: 50px; border: 1px solid #ccc;">
                      {% else %}
                        <em>No signature</em>
                      {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="3"><em>No employees for this site.</em></td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}

</div>
{% endblock %} 